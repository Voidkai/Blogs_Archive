# 第一章 计算机网络和Internet
## 计算机网络
两台以上具有图例操作系统的计算机通过某些介质连接成的相互共享软硬件资源的集合体。
计算机网络向用户提供的最重要的两个功能：

1. 连通性
2. 共享

## 1.1 什么是Internet

*  **Internet:"由网络构成的网络"**
    - 松散分层
    - 公用Internet和专用Internet
* 对于Internet，软件和硬件、提供的服务上，都很复杂，无法给出一个明确的定义
* 我们只能对其具体结构和提供服务方面进行描述

###1.1.1 什么是Internet：具体构成描述
* 数以亿计的计算互连设备
    - 主机（host） = 端系统（end system）
    - 运行网络应用程序
* 通信链路（link）
    - 双绞线、光纤、无线电频谱、卫星
    - 传输速率 = 带宽（bandwidth）
* 分组（packet）交换：
    - 路由器和交换机
* 网络构成网络：
    - 网络互连提供商ISP
* 协议（protocols）控制数据的发送和接受
    - HTTP、TCP、IP etc
* Internet standards
    - RFC： Request for comments
    - IETF： Internet Engineering Task Force

###1.1.2 什么是Internet：服务上描述
* 提供网络应用基础架构
    - 允许终端系统上运行分布式应用程序，并彼此交换数据：
        + Web、email、games、ecommerce、database、VOIP、P2P file sharing
* 为分布式应用程序提供的通信服务接口：
    - 无连接服务
    - 面向连接服务
    - 不提供数据传递时间保证（发送端到接收端）的服务

###1.1.3 Internet通信协议
* 控制发送和接收消息 - **协议**
    - e.g. TCP、IP、HTTP、FTP、PPP

**协议：定义了两个或多个通信实体间交换报文的格式和次序，以及报文发送和/或接收一条报文或者其他事件所采取的行动（响应）**

**协议的基本要素：语法、语义和同步**

* Internet标准：
    - IETF：
        + Internet Engineering Force
        + 因特网工程任务组
    - RFC：
        + Request for comments
        + 请求评论
        + 所有的因特网标准都以RFC的形式在因特网上发表。
            * 因特网草案： 不是RFC文档
            * 建议草案： 开始成为RFC文档
            * 草案标准
            * 因特网标准

![-2019-06-18-5.11.55.png](https://xuankai.wang/images/2019/06/18/-2019-06-18-5.11.55.png)

##1.2 网络边缘部分
###1.2.1 端系统、客户和服务器：
* 端系统（/主机）：
	* 运行网络应用程序
	* 处在网络的边缘
	* 传统主机/网络计算机和瘦客户
* 客户/服务器C/S模型：
	* 客户请求，并接收服务器提供的服务
	* e.g Web browser/server；email client/server
* 端对端模型 P2P：
	* 极少或不采用专门服务器
	* e.g Gnutella，KaZaA

---

####接入网络（access network）
Q:如何将终端系统连接到网络边缘的路由器？

* 一种粗糙的分类：
	* 家庭接入网络
	* 企业（和家庭）接入网络 
	* 广域无线接入网络
* 注意
	* 接入网络的带宽（bps）？
	* 共享/独占？ 

---
####家庭接入网络：点对点接入
* 拨号线路上使用modem
	* 可达56Kbps直接接入边缘路由器
	* 不能同时上网和博拨打电话：不能一直在线
* ISDN（Integrated Services Digital Network）：
	* 综合业务数字网，数字数据传输。2D+B，128Kbps
* ADSL（asymmetric digital subscriber line） 非对称数字用户线路
	* 可达1Mbps 上行速率
	* 可达8Mbps 下行速率

####家庭接入网络：cable modems（线缆调制解调器）
* HFC：（hybrid fiber coaxial cable）混合光纤同轴电缆
	* 非对称：可达2Mbps 上行速率，30Mbps 下行速率
* 光纤/同轴电缆混网：连接家庭住宅到ISP路由器
	* 各住宅共享到路由器之间的官博信道
	* 引起问题：拥堵，规模
* 部署：可以通过广电公司提供该网络接入服务

####家庭接入网络：FTTH（Fiber to the home）

---

####企业接入网络：local area network （LAN）
* 公司/大学局域网 LAN 连接端系统到边缘路由器
* 以太网 Ethernet：
	* 共享（共享式以太网）或独占（交换式以太网）链路链接端系统和边缘路由器
	* 10 Mbps， 100Mbps， Gigabit Ethernet， 10 Gbps
* WIFI接入技术
* 部署：企业、家庭局域网已经普及
* LANs：[chapter 5]()

####WiFi无线接入网络
* 共享的无线接入网络连接端系统到边缘路由器
	* 通过基站， 即接入点 ”access point“
* 无线局域网wireless LANs：
	* 802.11a/b/c(WiFi):54/11/54/600 Mbps

####广域无线接入网络（wide-area wireless access）
* 有电信运营商提供，均支持IP
* WAP/GPRS或CDMA
* 3G 提供下行 3.6 Mbps， 上行 384 kbps的带宽
* 4G 
* 5G

###1.2.2 物理介质
* 物理链路：发送方和接收方之间，传播位信号
* 引导型媒体：
	* 信号在固态介质中有向传播, 如：光纤、双绞线和同轴电缆等 
* 非导引型媒体: 
	* 信号在大气空间或外太空空间自由传播, 如：无线电

---
两根彼此绝缘、相互缠绕成螺旋状的铜线。缠绕的目的是减少电磁干扰，提高传输质量

* 屏蔽双绞线 (STP， Shielded Twisted Pair)         
* 非屏蔽双绞线 (UTP， Unshielded Twisted Pair )

####物理介质：同轴电缆和光纤电缆
同轴电缆：

* 两根彼此绝缘的同心导体
* 双向传输
* 基带baseband:
	* 50Ω，1cm
	* 单信号频带
	* 细缆以太网10base-2
* 宽带broadband:
	* 75Ω，较粗
	* 多信号频带
 	* 用于光纤同轴混合网HFC

光纤电缆：

* 光纤传导光脉冲, 每个光脉冲代表1位
* 高速传输:
	* 高速点对点传输 (可达数十或数百 Gbps)
* 低误码率: 中继到更远传输距离 ; 防止电磁干扰
* 难以被分光窃听

####物理介质：无线电波

* 以电磁频谱承载信号
* 没有物理连线
* 双向
* 传播环境的影响:
	* 多路径衰落－干扰物表面反射 
	* 盲区衰落－障碍物绕/透
	* 干扰－其他电磁信号

**无线链路类型**

* 地面微波<br>

	e.g. 达 45 Mbps 信道
* 局域无线通道 (e.g., WiFi)<br>

	11Mbps, 54Mbps，更高
* 广域无线通道 (e.g., cellular)<br>

	e.g.GPRS,CDMA<br>
	e.g. 3G: hundreds of kbps
* 卫星通信<br>

	高达数百Mbps 信道 (或多个更小的信道)<br>
	280 msec毫秒端到端延迟<br>
	地球同步卫星与低轨道卫星（铱星系统－66颗低空卫星）

###1.2.3 端系统上的因特网服务
*因特网在端系统上为应用程序之间的数据传递提供了哪些服务呢？*

* 面向连接的服务
	* 目的:  在端系统间传送数据。
	* 握手: 客户和服务器事先进入戒备状态，为接下来的分组交换做好准备
		* 如同Hello, hello back 这样的人类电话通信
		* 建立“连接” ，在两个彼此通信的端系统之间
	* TCP - Transmission Control Protocol
		* Internet的面向连接的服务
		
	* TCP 服务 [RFC 793]
		* 可靠、顺序、字节流传输: 
			* 丢失: 确认和重传
		* 流量控制: 
			* 发送者不至于淹没接收者
		* 拥塞控制: 
			* 当网络拥塞时发送者降低发送速率
	
* 无连接服务
	* 目的:  在端系统间传送数据。
	* UDP - User Datagram Protocol [RFC 768]: Internet无连接服务
		* 不可靠数据传输	
		* 无流量控制
		* 无拥塞控制


|使用TCP的网络应用	|使用UDP的网络应用	|
|----				|---	     		|
|HTTP、FTP、Telnet、SMTP|流媒体、视频会议、DNS、Internet电话|

##1.3 网络核心部分

*相互连接的路由器构成的网络如何在这个网络中传送数据？*

* 基本原理:
	* 电路交换: 每次会话预留沿其路径（线路）所需的独占资源－－电话网
	* 分组交换: 数据以离散的数据块通过网络来发送

|电路交换	|分组交换	|
|----				|---	     		|
|每次会话预留沿其路径（线路）所需的独占资源<br>－－电话网|数据以离散的数据块通过网络来发送|

###电路交换

* 网络资源（如带宽）被分片
* 多路复用（Multiple Access）
	* 分片分配到会话	
	* 分片没有被会话使用的情况下，分片空载(不共享)
	* 电路级性能（有保证）
	* 要求呼叫建立－－建立一个专门的端到端线路(意味着每个链路上预留一个线路)
	* 链路带宽分片
		* 频分－frequency division
		* 时分－time division


>从主机A到主机B经一个电路交换网络需要多长时间发送一个640Kb的文件?<br>
>假设：<br>
>所有链路都是 1.536 Mbps<br>
>每个链路使用TDM划分成24个时隙<br>
>创建一条端到端的链路需要500msec<br>

###分组交换

**每个端到端的数据流被划分成分组**

* 所有分组共享网络资源 
* 每个分组使用全部链路带宽 
* 资源按需使用 
* 资源竞争: 资源需求总量可以大于可获得资源的总量
* 拥塞: 采用分组队列, 等待使用链路
* 存储转发: 分组每次转发1站
	* 在1个链路上传输,每经过1个链路转发1次,转发分组前，要求收到完整分组

分组交换两大类：

* 数据报网络: TCP/IP
	* 分组目的地址决定下一跳
	* 会话期间路由可以改变
	* 比方: 驱车逐段问路 
* 虚电路网络: X.25,FR,ATM
	* 每个分组有1个标签  (虚电路号,virtual circuit ID), 标签决定下1跳
	* 连接建立时确定固定的路径, 并且将保持于整个会话期间
	* 路由器必须为每个连接维护状态信息



---
比较分组交换与电路交换

* 分组交换允许更多的用户使用网络

|              | 优点                                                         | 缺点                                                         | 问题                                                         |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **分组交换** | **适合大量的突发数据传输**<br>资源共享<br>简单，不需要建立连接 | **过度竞争**导致分组延迟与丢失<br>需要可靠数据传输、拥塞控制协议 | **如何提高电路级的性能**<br>对于音视频的网络应用需要带宽保障<br>任然是一个没有解决的问题[见chapter 6]() |



##1.4 Internet主干/ISPs的结构组成
* 构成Internet核心主干: “第一层” ISPs ＝National Backbone Provider (NBPs)国家/国际级ISP
* “第二层” ISPs: 较小的(通常是区域级的) ISPs
	* 连接到1个或多个 tier-1 ISPs, 也可能连接其他 tier-2 ISPs
* “Tier-3” ISPs and local ISPs 
	* 最后的接入网络（最接近端系统）

##1.5 分组交换网络中的延迟与丢失
>分组丢失和延迟是如何产生的？<br>
>路由器分组缓冲区队列:<br>分组到达输出链路的速率超过输出链路的容量,产生延迟,甚至丢失<br>
>分组在缓冲区队列排队, 按序等待

###分组延迟的四种类型

|      | 类型                                   | 说明                                                         | 其他                                     |
| ---- | -------------------------------------- | ------------------------------------------------------------ | ---------------------------------------- |
| 1    | 节点处理时延<br>Nodal processing delay | 检查错误位<br>选择输出链路<br>速路由器处理延迟－微妙级       | 典型几个微妙或更小                       |
| 2    | 排队时延<br>Queueing delay             | 等待被发送到输出链路上的时间<br>取决于路由器的拥塞程度       | 取决于路由器的拥塞程度                   |
| 3    | 传输时延<br>Transmission delay         | R=链路带宽 (bps)<br>L=分组长度 (bits)<br>发送分组比特流的时间 = L/R | 低带宽链路比较显著                       |
| 4    | 传播时延<br>Propagation delay          | d = 物理链路的长度<br>s = 介质的信号传播速度 (~2x108 m/sec)<br>传播延迟 = d/s | 几个微妙到数百毫秒（卫星通信高传播延迟） |
|      | 总时延                                 | d1 + d2 + d3 + d4                                            |                                          |

####派对时延详解
R=链路带宽 (bps)<br>
L=分组长度 (bits)<br>
a=平均分组到达率<br>
流量强度 = La/R

* La/R ~ 0: 分组稀疏到达,无队列,平均排队延迟极小接近于0
* La/R -> 1: 分组猝发到达,形成队列,队列长度迅速增加,排队延
                    迟大幅增大
* La/R > 1: 输出队列平均位到达速率超过送走这些位的极限速
                  率，输出队列持续增长，排队延迟趋于无穷大。

###分组丢失
* 路由器输入链路和输出链路的缓冲区容量有限
* 当分组到达路由器输入链路发现缓冲区已满，则路由器只好丢弃分组
* 当分组在路由器内部要转发到输出链路时发现输出缓冲区队列已满，路由器只好丢弃分组
* 丢失的分组可能被前路由节点、源节点重传，或不重传
* 丢包率或分组丢失率（packet loss rate/ratio）

###吞吐量
* 网络吞吐量
	* 瞬时吞吐量：某一瞬间的吞吐量
	* 平均吞吐量：一段时间内的吞吐量均值
* 单位时间内整个网络传输数据的速率或分组数
* 单位：bps或data packets per second

>瓶颈链路：link on end-end path that constrains  end-end throughput
>在端到端路径中制约吞吐量的链路


##1.6 协议层及其服务模型
|       Internet：       |
| :--------------------: |
|          host          |
|        routers         |
| links of various media |
|      applications      |
|       protocols        |
|  hardwre,<br>software  |

**ISO/OSI七层参考模型**

| 层号 | 层的名称   | 层的英文名称 | 层的英文缩写 |
| ---- | ---------- | ------------ | :----------: |
| 7    | 应用层     | Application  |      A       |
| 6    | 表示层     | Presentation |      P       |
| 5    | 会话层     | Session      |      S       |
| 4    | 传输层     | Transport    |      T       |
| 3    | 网络层     | Network      |      N       |
| 2    | 数据链路层 | Data Link    |      DL      |
| 1    | 物理层     | Physical     |      PL      |

**TCP/IP参考模型**

| before |      | 网络协议栈 |          功能          |
| :----: | :--: | :--------: | :--------------------: |
| 应用层 |      |   应用层   | 支持网络应用，报文传送 |
| 传输层 |      |   运输层   |  主机进程间数据段传送  |
|网络层|-->|网络层|主机(源目标节点)间分组传送
|网络接口层||数据链路层|相邻网络节点间的数据帧传送
|||物理层|物理介质上的比特传送

各层:

* 分布式
* 在各节点的网络实体(entities) 实现了各层的功能<br>
   主机实现5层功能，路由器和交换机实现2-3层功能。
* 网络实体完成功能动作, 对等实体交换消息 

>
* 实体: 定义自身功能的硬/软件的集合
* 对等实体: 两台计算机上同一层所属的程序、进程或实体称为该层的对等程序、对等进程或对等实体。

##1.7 攻击威胁下的网络
>网络并非安全，攻击者试图攻击与因特网相连的计算机，侵犯我们的隐私，危及我们的数据安全。

* 攻击方式：
	* 植入恶意软件
		* 僵尸网络
		* 病毒
		* 蠕虫 	
	* 攻击服务器和网络基础设施
		* 拒绝服务攻击（Dos）
			* 弱点攻击
			* 带宽洪泛
			* 连接洪泛		
	* 嗅探分组
		* 分组嗅探器：记录每个流经的分组拷贝的被动接收机
		* 容易受到攻击的网络：无线网络和以太网LAN
	* 伪装
		* 生成具有任意源地址、分组内容和目的地址的分组，然后将这个人工制作的分组传输到因特网中
		* 将具有虚假源地址的分组注入因特网的能力称为IP哄骗
		* 解决方法采用端点鉴别机制
	* 修改或删除报文
		* 中间人攻击 	

##1.8 计算机网络和Internet发展史（略）

##总结
* 计算机网络的定义
* 协议的定义和基本要素
* Internet的构成描述：
	* 具体构成：边缘（端系统，包括软件和硬件）、核心、接入网络和物理介质
	* 网络交换方式：电路和分组
	* 电路：时分和频分
	* 分组：数据报和虚电路
* 分组交换网络中的延迟及其计算
* TCP/IP的分层模型，各层PDU的名称和功能